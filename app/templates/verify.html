<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Email Verification</title>
  <style>
    body { font-family: system-ui, Arial; max-width: 420px; margin: 6rem auto; padding: 0 1rem; }
    form { display: grid; gap: .75rem; }
    label { display: grid; gap: .25rem; }
    input { padding: .6rem .7rem; border: 1px solid #bbb; border-radius: .5rem; }
    button { padding: .7rem .9rem; border: 0; border-radius: .6rem; background:#2255ee; color:#fff; cursor:pointer; }
    .msg { min-height: 1.2rem; margin-top:.5rem; }
    .ok { color:#0a7a26; } .err { color:#b40018; }
  </style>
</head>
<body>
  <h1>Email Verification</h1>

  <!-- Send code form -->
  <form id="start">
    <label>Email
      <input name="email" type="email" required />
    </label>
    <button type="submit">Send Code</button>
    <div class="msg" id="m1"></div>
  </form>

  <hr style="margin:1rem 0">

  <!-- Confirm code form -->
  <form id="confirm">
    <label>Email
      <input name="email" type="email" required />
    </label>
    <label>Verification Code (6 digits)
      <input name="code" inputmode="numeric" pattern="\d{6}" maxlength="6" required />
    </label>
    <button type="submit">Confirm</button>
    <div class="msg" id="m2"></div>
  </form>

  <p style="margin-top:.5rem">
    <a href="/auth/login">Back to Login</a>
  </p>

  <script>
  // Send verification code
  document.getElementById('start').addEventListener('submit', async (e) => {
    e.preventDefault();
    const f = e.target, m = document.getElementById('m1');
    m.textContent = '';
    const r = await fetch('/auth/verification/start', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ email: f.email.value.trim() })
    });
    m.textContent = r.ok ? 'Verification code sent.' : 'Failed to send code.';
    m.className = 'msg ' + (r.ok ? 'ok' : 'err');
  });

  // Confirm verification code
  document.getElementById('confirm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const f = e.target, m = document.getElementById('m2');
    m.textContent = '';
    const r = await fetch('/auth/verification/confirm', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        email: f.email.value.trim(),
        code: f.code.value.trim()
      })
    });

    if (r.redirected) {
      window.location.href = r.url;
    } else {
      m.textContent = r.ok ? 'Email verified successfully!' : 'Invalid or expired code.';
      m.className = 'msg ' + (r.ok ? 'ok' : 'err');
      if (r.ok) setTimeout(() => window.location.href = '/auth/login', 1000);
    }
  });
  </script>
</body>
</html>