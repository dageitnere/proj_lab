<!DOCTYPE html>
<html lang="lv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>E-pasta verifikācija</title>
  <style>
    body { font-family: system-ui, Arial; max-width: 420px; margin: 6rem auto; padding: 0 1rem; }
    form { display: grid; gap: .75rem; }
    label { display: grid; gap: .25rem; }
    input { padding: .6rem .7rem; border: 1px solid #bbb; border-radius: .5rem; }
    button { padding: .7rem .9rem; border: 0; border-radius: .6rem; background:#2255ee; color:#fff; cursor:pointer; }
    .msg { min-height: 1.2rem; margin-top:.5rem; }
    .ok { color:#0a7a26; } .err { color:#b40018; }
  </style>
</head>
<body>
  <h1>E-pasta verifikācija</h1>

  <form id="start">
    <label>E-pasts
      <input name="email" type="email" required />
    </label>
    <button type="submit">Sūtīt kodu</button>
    <div class="msg" id="m1"></div>
  </form>

  <hr style="margin:1rem 0">

  <form id="confirm">
    <label>E-pasts
      <input name="email" type="email" required />
    </label>
    <label>Kods (6 cipari)
      <input name="code" inputmode="numeric" pattern="\d{6}" maxlength="6" required />
    </label>
    <button type="submit">Apstiprināt</button>
    <div class="msg" id="m2"></div>
  </form>

  <p style="margin-top:.5rem"><a href="/auth/login">Atpakaļ uz login</a></p>

  <script>
  document.getElementById('start').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const f=e.target, m=document.getElementById('m1');
    m.textContent='';
    const r=await fetch('/auth/verification/start',{method:'POST',headers:{'Content-Type':'application/json'},
      body: JSON.stringify({email: f.email.value.trim()})});
    m.textContent = r.ok ? 'Kods nosūtīts.' : 'Neizdevās.';
    m.className='msg ' + (r.ok ? 'ok' : 'err');
  });

    document.getElementById('confirm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const f=e.target, m=document.getElementById('m2');
      m.textContent='';
      const r=await fetch('/auth/verification/confirm',{
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ email: f.email.value.trim(), code: Number(f.code.value) })
      });
      if(r.ok){ location.href='/auth/login'; }
      else{ const j=await r.json().catch(()=>({detail:'Neizdevās'}));
            m.textContent=j.detail||'Neizdevās'; m.className='msg err'; }
    });
  </script>
</body>
</html>
