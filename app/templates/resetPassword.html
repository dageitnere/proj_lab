<!DOCTYPE html><html lang="lv"><head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Jauna parole</title>
<style>
body{font-family:system-ui,Arial;max-width:420px;margin:6rem auto;padding:0 1rem}
form{display:grid;gap:.75rem}label{display:grid;gap:.25rem}
input{padding:.6rem .7rem;border:1px solid #bbb;border-radius:.5rem}
button{padding:.7rem .9rem;border:0;border-radius:.6rem;background:#2255ee;color:#fff;cursor:pointer}
.msg{min-height:1.2rem;margin-top:.5rem}.ok{color:#0a7a26}.err{color:#b40018}
</style>
</head><body>
<h1>Paroles nomaiņa</h1>
<form id="f">
  <label>Jaunā parole <input name="password" type="password" minlength="8" required></label>
  <button type="submit">Nomainīt</button>
  <div id="m" class="msg"></div>
</form>
<p style="margin-top:.5rem"><a href="/auth/login">Atpakaļ uz login</a></p>
<script>
function getToken(){ return new URL(location.href).searchParams.get('token') || ''; }
const f=document.getElementById('f'), m=document.getElementById('m');
f.addEventListener('submit', async (e)=>{
  e.preventDefault(); m.textContent='';
  const r=await fetch('/auth/reset-password/confirm',{method:'POST',headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ token: getToken(), new_password: f.password.value })});
  if(r.ok){ m.textContent='Parole nomainīta. Vari ieiet.'; m.className='msg ok'; setTimeout(()=>location.href='/auth/login',900); }
  else { const j=await r.json().catch(()=>({detail:'Neizdevās'})); m.textContent=j.detail||'Neizdevās'; m.className='msg err'; }
});
</script>
</body></html>
