<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Complete Profile</title>
  <style>
    body { font-family: system-ui, Arial; max-width: 520px; margin: 6rem auto; padding: 0 1rem; }
    form { display: grid; gap: .75rem; }
    label { display: grid; gap: .25rem; }
    input, select { padding: .6rem .7rem; border: 1px solid #bbb; border-radius: .5rem; }
    button { padding: .7rem .9rem; border: 0; border-radius: .6rem; background:#2255ee; color:#fff; cursor:pointer; }
    .row { display:flex; gap:.75rem }
    .row > label { flex:1 }
    .msg { min-height: 1.2rem; margin-top:.5rem; }
    .ok { color:#0a7a26 } .err { color:#b40018 }
  </style>
</head>
<body>
  <h1>Complete Your Registration</h1>
  <form id="f">
    <div class="row">
      <label>Age
        <input name="age" type="number" min="10" max="120" required>
      </label>
      <label>Gender
        <select name="gender" required>
          <option value="MALE">Male</option>
          <option value="FEMALE">Female</option>
        </select>
      </label>
    </div>

    <div class="row">
      <label>Weight (kg)
        <input name="weight" type="number" step="0.1" min="1" required>
      </label>
      <label>Height (cm)
        <input name="height" type="number" step="0.1" min="50" required>
      </label>
    </div>

    <div class="row">
      <label>Vegan?
        <select name="isVegan">
          <option value="false">No</option>
          <option value="true">Yes</option>
        </select>
      </label>
      <label>Vegetarian?
        <select name="isVegetarian">
          <option value="false">No</option>
          <option value="true">Yes</option>
        </select>
      </label>
      <label>Dairy products?
        <select name="isDairyInt">
          <option value="false">Yes</option>
          <option value="true">No (intolerance)</option>
        </select>
      </label>
    </div>

    <label>Goal
      <select name="goal" required>
        <option value="MAINTAIN">Maintain weight</option>
        <option value="LOSE">Lose weight</option>
        <option value="GAIN">Gain weight</option>
      </select>
    </label>

    <label>Activity Level
      <select name="activityFactor" required>
        <option value="SEDENTARY">Sedentary (little movement)</option>
        <option value="LIGHT">Light (1–3x per week)</option>
        <option value="MODERATE">Moderate (3–5x per week)</option>
        <option value="ACTIVE">Active (6–7x per week)</option>
        <option value="VERY_ACTIVE">Very active (2x per day)</option>
      </select>
    </label>

    <button type="submit">Save</button>
    <div id="m" class="msg"></div>
  </form>

  <script>
    const f = document.getElementById('f'), m = document.getElementById('m');
    f.addEventListener('submit', async (e) => {
      e.preventDefault(); m.textContent='';
      const body = {
        age: Number(f.age.value),
        gender: f.gender.value,
        weight: Number(f.weight.value),
        height: Number(f.height.value),
        isVegan: f.isVegan.value === 'true',
        isVegetarian: f.isVegetarian.value === 'true',
        isDairyInt: f.isDairyInt.value === 'true',
        goal: f.goal.value,
        activityFactor: f.activityFactor.value
      };
      const r = await fetch('/profile/completeInfo', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(body)
      });
      if (r.ok) {
        m.textContent='Saved. Redirecting to the main page...';
        m.className='msg ok';
        setTimeout(()=>location.href='/',800);
      } else {
        const j = await r.json().catch(()=>({detail:'Error'}));
        m.textContent=j.detail||'Failed';
        m.className='msg err';
      }
    });
  </script>
</body>
</html>